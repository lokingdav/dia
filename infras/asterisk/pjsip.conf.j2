[global]
type=global
user_agent=Asterisk-EC2

; -------- Transport --------
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060

; NAT: EC2 has private IP, clients reach public IP
external_signaling_address={{ asterisk_externaddr }}
external_signaling_port=5060
external_media_address={{ asterisk_externaddr }}

; set this to your VPC CIDR
local_net=172.31.0.0/16

; -------- Common endpoint policy (TEMPLATE) --------
[endpoint-common](!)
type=endpoint
context=from-internal
disallow=all
allow=ulaw,alaw
; enable only if you know you have codec + endpoints
;allow=opus

; NAT helpers for typical internet clients
rtp_symmetric=yes
force_rport=yes
rewrite_contact=yes

; Keep Asterisk in media path (simpler on EC2)
direct_media=no

{% for ext in asterisk_extensions %}
; Endpoint name == extension number (easy dialing)
[{{ ext.id }}](endpoint-common)
type=endpoint
auth={{ ext.id }}-auth
aors={{ ext.id }}-aor

[{{ ext.id }}-auth]
type=auth
auth_type=userpass
username={{ ext.id }}
password={{ ext.password }}

[{{ ext.id }}-aor]
type=aor
max_contacts=1
remove_existing=yes
{% endfor %}
